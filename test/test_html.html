<html>
  <head>
    <title>Test page</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="../nice.js"></script>
  </head>
  <body>
<script>
"use strict";
const { Test, expect, Html, Box, RBox, Arr,
  Div, Span, H1, H2, H3, B, I, A, Ol, next } = nice;
 
//const counter = Box(0).interval(next, 1000);
//const counter2 = Box(0).interval(next, 500);


Test('Update basic html', (Html) => {
  var d = Div(Arr('qwe', 'asd')).color('red');
  var last = d;
  var dom = d.dom;
//  document.body.appendChild(dom);

  function change(e){
    nice.refreshElement(e, last, dom);
    last = e;
  }

  change(Div(Arr('qwe', 'asd')).color('blue'));
  expect(dom.textContent).is('qweasd');
  expect(dom.style.color).is('blue');
  
  change(Div(Arr('qwe', 'asd')).id('qqwe1').color('blue'));
  expect(dom.textContent).is('qweasd');
  expect(dom.style.color).is('blue');
  expect(dom.id).is('qqwe1');

  change(Div(Arr('qwe', 'asd')).color('green'));
  expect(dom.textContent).is('qweasd');
  expect(dom.style.color).is('green');
  expect(dom.id).is('');


  change(Div(Arr('qwe', 'zxc', 'asd')).color('green'));
  expect(dom.textContent).is('qwezxcasd');
  expect(dom.style.color).is('green');
  expect(dom.id).is('');

  
  change(Div(Arr('qwe', 'poi', 'asd')).color('green'));
  expect(dom.textContent).is('qwepoiasd');

  
  change(Div(Arr('qwe')).id('asd').color('green'));
  expect(dom.textContent).is('qwe');
  
  change(Div(Arr('qwe', 'asd')).id('asd').color('green'));
  expect(dom.textContent).is('qweasd');

  change(Div(Arr('asd')).id('asd').color('green'));
  expect(dom.textContent).is('asd');

//  change(Div().userView('Jo').userView('Jane').add('footer'));
//  change(Div().add('header').userView('Jim').userView('Jane').add('footer'));
});

Test('Update custom html', (Html) => {
  var d = Div(Arr('qwe', 'asd')).color('red');
  var last = d;
  var dom = d.dom;

  Html.extend('UserView').by((z, id) => z.id(id).h1('User ' + id));

  function change(e){
    nice.refreshElement(e, last, dom);
    last = e;
  }

  change(Div(Arr('asd')).id('asd').color('green'));
  expect(dom.textContent).is('asd');

  change(Div().userView('Jo').userView('Jane').add('footer'));
  expect(dom.textContent).is('User JoUser Janefooter');
  
  change(Div().add('header').userView('Jim').userView('Jane').add('footer'));
  expect(dom.textContent).is('headerUser JimUser Janefooter');

  change(Div().add('qwe'));
  expect(dom.textContent).is('qwe');
});

Test('Foolow Box', (Html) => {
  const box = Box(5);
  const div = Div('N: ', box);
  var dom = div.dom;
  
  expect(dom.textContent).is('N: 5');
  
  box(6);
  expect(dom.textContent).is('N: 6');
});

  
Test('Foolow RBox', (Html) => {
  const b = Box(1);
  const rb = RBox(b, n => H1(n));
  const div = Div(rb);
  const dom = div.dom;

  document.body.appendChild(dom);

  b(2);
  expect(dom.innerHTML).is('<h1>2</h1>');
});


Test('Textarea', (Html, Textarea) => {
  const x = Textarea(2);
  const dom = x.dom;
  expect(dom.outerHTML).is('<textarea>2</textarea>');
  x.value('qwe');
  //strange dom.outerHTML never updates
//  expect(dom.outerHTML).is('<textarea>qwe</textarea>');
  expect(dom.value).is('qwe');
});

//H3('Counter').show();
//RBox(counter, c => Div('1: ', c)).show();
//RBox(counter2, c => Div('2: ', c)).show();
//
//
//H3('Underlined | not underlined, always orange').show();
//const orangeLink = RBox(counter, c => Div(A('qw', 'Some link'))
//  .Css('A').color('orange')
//    .textDecoration(c % 2 ? 'underline' : 'none').up);
//orangeLink.show();
//    
//    
//H3('Bold and italic').show();
//Div().b('bold').span(' and ').i('italic').show();
//
//
//H3('Add/remove text nodes 2x 1/123').show();
//RBox(counter, c => Div(c % 2 ? [1, 2, 3] : [1])).show();
//RBox(counter, c => Div(c % 2 ? [1, 2, 3] : ['', 1])).show();
//
//
//H3('Add/remove text nodes qwe/qaz').show();
//RBox(counter, c => Div(c % 2 
//  ? [Span('q'), 'w', Span('e')] 
//  : [Span('q'), Span('a'), 'z'])).show();
//
//
//H3('Blink green blue red').show();
//const color = RBox(counter2, c => c % 2 ? 'red' : 'blue');
//Div('BLINK').color(RBox(counter, color, (n, c) => n % 2 ? c : 'green')).show();
//
//
//
//H3('Focused input & result').show();
//const input = nice.Input().value('555').focus();
//const result = RBox(input.value, s => Div(I('Result is: ')).B(s));
//Div(input, result).show();
//
//
//H3('Checked checkbox ').show();
//const c = nice.Checkbox(true);
//Div(c, RBox(c.checked, c => Span(c ? 'Yes' : 'No'))).show();
//
//
//H3('Textarea').show();
//const text = nice.Textarea('qewqweqwqw');
//text.show();
//RBox(text.value, s => Div().I('Length: ', s.length)).show();
//
//H3('Ordered list of a, b').show();
//Ol(['a','b']).show();

nice.runTests('Html');
</script>
  
  </body>
</html>
