<html>
  <head>
    <title>TODO list example</title>
    <script src="../nice.js"></script>
  </head>
  <body style="margin:0">
<script>
const { Type, Arr, Div, Span, Input, A, Switch, Model, Box, RBox } = nice;


const model = Model();


model.set('tasks', '0', 'buy milk');

//model.Action('createTask', text => {
//  expect(text).isString();
//  model.set('tasks', null, { text });
//});

model.getBox('tasks', 1);


const KEY = 'ToDoData';

//const Task = Type('Task', (z,s) => s && z.text(s)).str('text').bool('status')();

//const tasks = Switch(localStorage.getItem(KEY))
//  .isNull().use(() => Arr(Task('Buy milk'), Task("Walk the dog")))
//  .default.use(s => nice.fromJson(JSON.parse(s)));

//tasks.listen(v => localStorage.setItem(KEY, JSON.stringify(v.jsValue)));

const create = e => {
  tasks.push(Task(search.value()));
  search.value("");
  e.preventDefault();
};

const search = Input("search").placeholder('Type to search or add tasks')
  .autocomplete("off").autofocus(true)
  .boxSizing('border-box').width("100%").fontSize("20px").padding('.2em .3em')
  .on('keyup', e => e.key === 'Enter' && create(e));

const deleteButton = (state, k) => state && A(() => tasks.remove(k), 'x')
    .textDecoration('none').color('#E33').marginLeft('.5em');

const TaskView = id => RBox(model.getBox('tasks', id), task => {
//  const isHover = Box(false);
  return Div(task).padding("1em 0")
//    .on('mouseover', () => isHover(true))
//    .on('mouseleave', () => isHover(false))
//    .Checkbox(task.status)
//      .on('change', e => tasks.get(id).status(e.target.checked))
//      .up
//    .Span(task)//.text.or('---')
//      .marginLeft(".5em")
//      .textDecoration.by(() => task.status() ? 'line-through' : 'none')
////      .textDecoration(Switch(task.status).isTrue('line-through').else('none'))
//      .up
////    .add(RBox(task.status, s => Span(task.text || '---')
////        .marginLeft(".5em")
////        .textDecoration(s() ? 'line-through' : 'none')))
//    .add(deleteButton(isHover, id));
});    



//const tasksView = Div()
//  .mapChildren(model.keyBox('tasks'), id => 
//    RBox(model.getBox('tasks', id), TaskView));


//const tasks = model.path();
const tasksView = RBox(search.boxValue(), s => {
  return Div(model.keyBox('tasks').map(TaskView));
});
//  .mapChildren(tasks.keyBox(), id => RBox(tasks.getBox(id), TaskView));
//  .mapChildren(tasks.keyBox(), TaskView);

//  tasks.filter(t => RegExp(search.value, 'i').test(t.text))
//    .map(TaskView),
////  RBox(search.value, tasks, (s, ts) => 
////    Div(ts.filter(t => RegExp(s, 'i').test(t.text)).map(TaskView))),
//  By(() => search.value.size.gt(0) && Div().padding("1em 0")
//      .A(create, 'Add: ', search.value).textDecoration('none').up
//      .Span(' [Enter]').color('#999').fontSize('small').up)
////  Switch(search.value)
////    .not.empty(s => Div().padding("1em 0")
////      .A(create, 'Add: ', s).textDecoration('none').up
////      .Span(' [Enter]').color('#999').fontSize('small').up)
////  
////  RBox(search.value, s => s && Div().padding("1em 0")
////    .A(create, 'Add: ', s).textDecoration('none').up
////    .Span(' [Enter]').color('#999').fontSize('small').up)
//) 

Div(search, tasksView)
  .font("20px Arial")
  .padding("1rem")
  .show();
  
</script>
  </body>
</html>
